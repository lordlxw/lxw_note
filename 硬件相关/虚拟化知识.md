## 背景知识

> ESXi（VMware ESXi）和 Proxmox Virtual Environment（PVE）都是用于虚拟化的平台，但它们有不同的供应商和特点：
>
> 1. **ESXi（VMware ESXi）**：
>    - **供应商**：由 VMware 公司开发和提供支持。
>    - **特点**：VMware ESXi 是一种基于类型 1（裸机）的虚拟化解决方案，通常安装在物理服务器上，直接在硬件上运行。它是 VMware vSphere 虚拟化平台的核心组件之一，提供了高性能、稳定性和广泛的虚拟化功能。ESXi 支持虚拟机创建、管理、迁移、快照、资源池管理等高级特性，适用于企业级虚拟化环境。
>    - **许可模型**：VMware 提供多个版本的 ESXi，包括免费的 ESXi Hypervisor 版本以及更高级的版本，需要购买许可证。
> 2. **Proxmox Virtual Environment（PVE）**：
>    - **供应商**：Proxmox VE 是一个开源的虚拟化管理平台，由 Proxmox Server Solutions 开发和维护。
>    - **特点**：Proxmox VE 结合了虚拟化和容器虚拟化技术。它基于 KVM（Kernel-based Virtual Machine）和 LXC（Linux Containers）等技术，提供了虚拟机和容器两种虚拟化形式。PVE 具有 Web 界面，允许管理员轻松创建、管理虚拟机和容器，以及执行备份、存储管理等任务。Proxmox VE 是一款免费开源的虚拟化平台，适用于中小型企业和个人用户。
>    - **许可模型**：Proxmox VE 是开源的，可以免费使用，并提供付费的企业支持订阅。
>
> 简单来说，Esxi独占鳌头，性能很好

## 集群

> 集群，传统的
>
> 一个集群（Cluster）是由多台计算机或服务器组成的一个网络或集合，它们协同工作以提供更高的性能、可用性和可扩展性。集群的目标通常是增加系统的稳定性和效率。
>
> 一台服务器里有多个虚拟机，如果一台虚拟机坏了可以自动迁移到另一台服务器中
>
> 特点，外接存储阵列。
>
> 集群的优势包括：
>
> - **高可用性**：如果一个节点出现故障，其他节点可以继续提供服务，确保系统的可用性。
> - **负载均衡**：请求可以分散到多个节点，以确保每个节点的负载均衡，提高性能。
> - **可扩展性**：可以轻松地向集群中添加更多的节点，以应对不断增长的工作负载。
> - **容错性**：集群可以通过冗余和备份来提高容错性，以防止数据丢失或服务中断。
>
> 虽然集群可以提供高性能、高可用性和可扩展性，但也存在一些缺点和挑战，包括：
>
> 1. **复杂性**：集群通常需要更复杂的管理和维护，包括配置、监视、故障排除和升级。这可能需要更多的人力资源和专业知识。
> 2. **成本**：构建和维护集群通常需要更多的硬件、软件和网络资源，这可能会导致较高的成本。此外，高可用性和容错性的实现可能需要更多的冗余设备。
> 3. **网络延迟**：在分布式集群中，节点之间的通信需要通过网络进行，这可能导致网络延迟和带宽瓶颈。这可能会影响应用程序的性能。
> 4. **一致性和复制问题**：在分布式数据库和存储系统中，确保数据一致性和复制可能会变得复杂。错误的配置或管理可能导致数据一致性问题。
> 5. **安全性**：集群中的多个节点和复杂的网络通信可能增加安全风险。需要采取额外的安全措施来保护集群免受攻击。
> 6. **软件兼容性**：某些应用程序可能不容易适应集群环境，需要进行修改或重新设计才能充分利用集群的优势。
> 7. **性能调优**：为了充分发挥集群的性能，需要进行性能调优和负载均衡。这可能需要深入的了解和测试。
> 8. **故障排查**：在集群中，故障排查可能更加复杂，因为需要考虑多个节点和组件之间的相互作用。定位问题可能需要更多的时间和资源。

> ![image-20230911131231903](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230911131231903.png)



> 每台服务器有两块HBA卡，分别连SAN1交换机和SAN2交换机，做到双击热备
>
> HBA卡是一种专门用于连接主机计算机与存储设备（通常是SAN中的存储阵列）的硬件适配器。它的作用是充当主机和SAN之间的接口，使主机能够访问和与存储设备通信。
>
> HBA卡通常与SAN交换机或存储设备连接，通过光纤通道（Fiber Channel）或以太网等协议传输数据。这使得主机可以远程访问存储设备，实现高性能、高可用性、可扩展性和冗余性的存储解决方案。SAN架构允许多个主机同时访问共享存储资源，从而支持数据中心中的多台服务器。



## 超融合

> ### **分布式存储 + 虚拟化融合部署才是超融合本质**
>
> 
>
> 在部署超融合基础设施时，选择适当的交换机非常重要，因为交换机直接影响到整个超融合系统的性能、可靠性和可扩展性。交换机要求很高，需要万兆和VLAN支持。
>
> 三副本" 是分布式系统和存储系统中的一个术语，指的是在系统中对数据的冗余备份策略。它意味着系统会将每份数据存储在三个不同的地方或节点上，以增加数据的可靠性和冗余性。这种冗余备份策略有助于提高数据的可用性，并防止数据丢失或损坏。
>
> "负载均衡" 是指在虚拟化环境中，尽量使每台 ESXi 主机上运行的虚拟机负载相对均匀，以便充分利用资源，并确保高性能和高可用性。但并不一定要求每台 ESXi 主机上运行的虚拟机数量完全相等。![image-20230911132658576](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230911132658576.png)
>
> 其实就是分布式，省钱不用买磁盘阵列、盘龙和机柜了，存储磁盘就在各个服务器中。
>
> VSAN——用软件来管理
>
> VSAN是一种虚拟存储技术，通常是软件定义的存储解决方案，而不是基于物理硬件的SAN。VSAN利用服务器的本地存储资源（硬盘）来创建虚拟化的存储池，以提供存储功能。主要特点包括：
>
> - **基于软件**：VSAN通常是基于软件的解决方案，不需要专用的硬件存储设备。它利用服务器的本地硬盘来构建虚拟存储。
> - **分布式存储**：VSAN使用多台服务器上的硬盘来创建分布式存储池。数据被分散存储在不同的服务器上，以提高可用性和性能。
> - **虚拟化集成**：VSAN通常与虚拟化平台（如VMware vSphere）集成，以提供虚拟机级别的存储管理。
>
> ![image-20230911133113201](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230911133113201.png)

> 用软件来分配存储空间大小。
>
> 其中每个节点都需要配置 SSD 盘作为缓存，缓存容量远大于传统存储的[易失性内存](https://www.zhihu.com/search?q=易失性内存&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1553603735})，且多节点并发带来更强的[聚合性能](https://www.zhihu.com/search?q=聚合性能&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1553603735})。逻辑上看，存储不再是由 RAID 构成的不同存储空间，而是一个统一可弹性扩展的[存储池](https://www.zhihu.com/search?q=存储池&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1553603735})，并且具备更强的扩展能力；
>
> 分布式存储带来的另一个好处，是在统一的资源池内性能和容量都可以按需配置，而且数据可以自动均衡；







> **ESXI 和 VCenter 概念上的区别**
>
> ESXI是用于管理硬件层面上计算机可用的计算资源
>
> VCenter则是用于多个ESXI服务器，可以启用高可用性和容错能力
>
> VM Sphere 是一个平台，其中包括esxi和vcenter，都是其组件





## Vm-Esxi

> 背景知识：
>
> ESXI分为免费版和付费版
>
> 常说的Esxi 全称是 VMware vSphere Hypevisor
>
> vShpere是整个虚拟化方案，指整套虚拟化方案所需组件的总和，所以Esxi也是vSphere的组件之一，vSphere Client也是一个组件（一个由软件搭建的web管理平台）
>
> 部署了vShpere Web Client的服务器又叫vCenter Server

> 任何进阶的前提就是安装了vsphere client
>
> *影响虚机流畅程度的最大因素是硬盘
>
> 虚拟化对硬盘的要求不光是读写速度，还有每秒读写次数IOPS
>
> 创建虚机的时候——选择虚拟磁盘格式，选厚置备快速置零
>
> 1. **厚置备（Thick Provisioning）**：厚置备是一种虚拟机磁盘分配的方式，它在虚拟磁盘创建时会预分配磁盘空间。这意味着虚拟磁盘的实际磁盘空间会立即分配给虚拟机，无论虚拟机是否实际上使用了这些空间。厚置备通常可以提供更好的性能，因为虚拟磁盘的空间是立即可用的，但它也会浪费磁盘空间，因为虚拟机未必会立即使用所有分配的空间。
> 2. **快速置零（Zeroing）**：快速置零是指在创建虚拟机磁盘时，只分配磁盘空间但不立即填充数据。这意味着虚拟磁盘在创建时不会被填充零值或其他数据，而只是分配一个虚拟大小的空磁盘。当虚拟机开始写入数据时，才会逐渐填充磁盘。这可以节省磁盘空间，但可能会导致性能稍微下降，因为写入数据时需要进行实际的磁盘写操作。



### Esxi配置要点

> 1、管理好时间，因为众多虚拟机要管理
>
> NTP服务器
>
> 注意，要策略里设置自启动
>
> 
>
> 2、Esxi自启动服务
>
> 自动启动里可以设置——会在开启Esxi系统的两分钟后开启虚拟机
>
> 也可以设置启动顺序
>
> 
>
> 3、ESXI数据存储浏览器
>
> ESXi 的数据存储浏览器通常用于管理和存储虚拟机的 ISO 镜像文件，以便在虚拟机中安装操作系统或其他应用程序。
>
> 
>
> 4、创建虚拟机的时候
>
> 用Sata控制器而不是Scsi控制器，CD/DVD选我们上传的iso镜像
>
> 磁盘模式 独立-持久



### VCenter配置要点

> 1、关闭密码过期策略，否则90天会叫你修改一次密码
>
> 2、新建数据中心，搭建集群，添加ip即可
>
> 如果只是一台esxi，则只开启DRS就行，一台的话开了HA也用不了
>
> 编辑Vapp可以修改虚拟机启动顺序，配置DHCP